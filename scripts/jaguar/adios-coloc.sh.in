#!/bin/bash
#    Begin PBS directives
#PBS -A csc025ewk
#PBS -M @JOB_STATUS_EMAIL@
#PBS -m abe
#PBS -N TCGA.@RUN_NAME@
#PBS -j oe
#PBS -l walltime=@WALL_TIME@,size=@PROC_COUNT@
#PBS -l gres=widow2%widow3
#PBS -V
#    End PBS directives and begin shell commands

# replaced with -V.   source ~/jaguar_env.sh

BINDIR=/tmp/work/pantc/nscale
cd $BINDIR/bin
DATADIR=/lustre/widow2/proj/csc025/tkurc1/bcrTCGA/20Xtiles
OUTDIR=/lustre/widow2/proj/csc025/pantc

date
aprun -S 8 -n @PROC_COUNT@ ${BINDIR}/bin/nu-segment-scio-adios.exe ${DATADIR} ${OUTDIR}/TCGA.@RUN_NAME@.is1-1 @ADIOS_TRANSPORT@ @TILE_COUNT@ @BUFFER_SIZE@ cpu 1 1 0
date
rm -rf ${OUTDIR}/TCGA.@RUN_NAME@.1-1
date
aprun -S 8 -n @PROC_COUNT@ ${BINDIR}/bin/nu-segment-scio-adios.exe ${DATADIR} ${OUTDIR}/TCGA.@RUN_NAME@.is16-1 @ADIOS_TRANSPORT@ @TILE_COUNT@ @BUFFER_SIZE@ cpu 16 1 0
date
rm -rf ${OUTDIR}/TCGA.@RUN_NAME@.16-1
date
aprun -S 8 -n @PROC_COUNT@ ${BINDIR}/bin/nu-segment-scio-adios.exe ${DATADIR} ${OUTDIR}/TCGA.@RUN_NAME@.is@PROC_COUNT@-1 @ADIOS_TRANSPORT@ @TILE_COUNT@ @BUFFER_SIZE@ cpu @PROC_COUNT@ 1 0
date
rm -rf ${OUTDIR}/TCGA.@RUN_NAME@.@PROC_COUNT@-1
date

rm ${OUTDIR}/TCGA.@RUN_NAME@.*.bp


exit 0
