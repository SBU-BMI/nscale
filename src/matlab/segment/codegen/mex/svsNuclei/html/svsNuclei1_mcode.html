<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1">  1</a></span><span class="line"><span class="keyword">function</span> svsNuclei(<span class="var type1" id="S2T2U5">impath</span>,<span class="var type1" id="S3T2U6">filename</span>,<span class="var type1" id="S4T2U7">resultpath</span>, <span class="var type1" id="S5T6U8">folder</span>,<span class="var type1" id="S6T6U9">tile</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2">  2</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,3">  3</a></span><span class="line">    <span class="comment">% removed return var of "nuclei"</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4">  4</a></span><span class="line">    <span class="keyword">if</span> nargin==0</span></span>
<span class="srcline"><span class="lineno"><a href="1,5">  5</a></span><span class="line">        <span class="var type0" id="S8T0U18">image</span> = {<span class="string">'astroII.1.ndpi-0000004096-0000004096.tif'</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6">  6</a></span><span class="line">            <span class="string">'2487_71614_48776_2462x1616.tif'</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7">  7</a></span><span class="line">            <span class="string">'2487_69236_37042_2462x1616.tif'</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8">  8</a></span><span class="line">            <span class="string">'2497_31102_51514_2462x1616.tif'</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9">  9</a></span><span class="line">            <span class="string">'2496_58448_61628_2462x1616.tif'</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10"> 10</a></span><span class="line">            <span class="string">'2498_166520_32534_2462x1616.tif'</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11"> 11</a></span><span class="line">            };</span></span>
<span class="srcline"><span class="lineno"><a href="1,12"> 12</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S9T0U29">i</span> =1</span></span>
<span class="srcline"><span class="lineno"><a href="1,13"> 13</a></span><span class="line">            <span class="var type2" id="S2T0U33">impath</span>=<span class="string">'/Users/kongj/Glioma/Whole_TCGA_Slides/4K/code20x/'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14"> 14</a></span><span class="line">            <span class="var type2" id="S3T0U37">filename</span>=<span class="var type0" id="S8T0U39">image</span>{<span class="var type0" id="S9T0U40">i</span>};</span></span>
<span class="srcline"><span class="lineno"><a href="1,15"> 15</a></span><span class="line">            <span class="var type2" id="S4T0U43">resultpath</span>=<span class="var type2" id="S2T0U44">impath</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16"> 16</a></span><span class="line">            svsNuclei(<span class="var type2" id="S2T0U48">impath</span>,<span class="var type2" id="S3T0U49">filename</span>,<span class="var type2" id="S4T0U50">resultpath</span>,0,0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,17"> 17</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18"> 18</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19"> 19</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25"> 25</a></span><span class="line">    <span class="comment">%============START================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27"> 27</a></span><span class="line">    <span class="var type0" id="S11T0U57">p</span>.AN=<span class="mxinfo" id="T18:U6"><span class="string">'NS-MORPH'</span></span>;    <span class="comment">%TCGA dataset</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28"> 28</a></span><span class="line">    <span class="var type0" id="S11T0U63">p</span>.SN=<span class="mxinfo" id="T19:U7"><span class="string">'1'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29"> 29</a></span><span class="line">    <span class="var type0" id="S11T0U70">p</span>.PA.THR=<span class="mxinfo" id="T6:U8">0.9</span>;<span class="var type0" id="S11T0U78">p</span>.Par.T1=<span class="mxinfo" id="T6:U9">5</span>;<span class="var type0" id="S11T0U86">p</span>.Par.T2=<span class="mxinfo" id="T6:U10">4</span>;<span class="var type0" id="S11T0U94">p</span>.Par.G1=<span class="mxinfo" id="T6:U11">80</span>;<span class="var type0" id="S11T0U102">p</span>.Par.G2=<span class="mxinfo" id="T6:U12">45</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30"> 30</a></span><span class="line">    <span class="comment">%p.SN='2';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31"> 31</a></span><span class="line">    <span class="comment">%p.PA.THR=0.9;p.Par.T1=5;p.Par.T2=4;p.Par.G1=80;p.Par.G2=30;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32"> 32</a></span><span class="line">    <span class="var type0" id="S11T0U109">p</span>.SR=<span class="mxinfo" id="T14:U13"><span class="string">'20x'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33"> 33</a></span><span class="line">    <span class="var type0" id="S11T0U115">p</span>.AR=<span class="mxinfo" id="T14:U14"><span class="string">'20x'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34"> 34</a></span><span class="line">    <span class="var type0" id="S11T0U121">p</span>.CR=<span class="mxinfo" id="T19:U15"><span class="string">'1'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36"> 36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,37"> 37</a></span><span class="line">    <span class="comment">% p.AN='NS-MORPH';    %VALIDATION dataset</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38"> 38</a></span><span class="line">    <span class="comment">% p.SN='1';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39"> 39</a></span><span class="line">    <span class="comment">% p.PA.THR=0.9;p.Par.T1=5;p.Par.T2=4;p.Par.G1=80;p.Par.G2=45;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40"> 40</a></span><span class="line">    <span class="comment">% %p.SN='2';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41"> 41</a></span><span class="line">    <span class="comment">% %p.PA.THR=0.9;p.Par.T1=5;p.Par.T2=4;p.Par.G1=80;p.Par.G2=30;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42"> 42</a></span><span class="line">    <span class="comment">% p.SR='40x';      %Scanning Resolution   %40X--18slides; %20x--necrosis</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43"> 43</a></span><span class="line">    <span class="comment">% p.AR='20x';      %Analysis Resolution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44"> 44</a></span><span class="line">    <span class="comment">% p.CR='0.5';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,46"> 46</a></span><span class="line">    <span class="comment">%TONY - imread is not supported by matlab coder</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47"> 47</a></span><span class="line">    coder.extrinsic(<span class="string">'imread'</span>, <span class="string">'rgb2gray'</span>, <span class="string">'tic'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,48"> 48</a></span><span class="line">    <span class="comment">%END TONY</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49"> 49</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,50"> 50</a></span><span class="line">    <span class="mxinfo" id="T1:U16"><span class="var type1" id="S13T1U134">I</span> = <span class="mxinfo" id="T1:U18">zeros(1,1,3,<span class="string">'uint8'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51"> 51</a></span><span class="line">    assert(isa(<span class="mxinfo" id="T1:U19"><span class="var type1" id="S13T1U146">I</span></span>,<span class="string">'uint8'</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,52"> 52</a></span><span class="line">    <span class="mxinfo" id="T1:U21"><span class="var type1" id="S13T1U150">I</span>=<span class="mxinfo" id="T3:U23">imread(<span class="mxinfo" id="T2:U24">[<span class="var type1" id="S2T2U155">impath</span>,<span class="var type1" id="S3T2U156">filename</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,54"> 54</a></span><span class="line">    <span class="mxinfo" id="T6:U27"><span class="var type1" id="S18T6U159">THR</span> = <span class="mxinfo" id="T6:U29">0.9</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55"> 55</a></span><span class="line">    <span class="mxinfo" id="T3:U30"><span class="var type1" id="S19T3U163">grayI</span> = <span class="mxinfo" id="T3:U32">rgb2gray(<span class="var type1" id="S13T1U166">I</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56"> 56</a></span><span class="line">    <span class="mxinfo" id="T6:U34"><span class="var type1" id="S21T6U169">area_bg</span> = <span class="mxinfo" id="T6:U36">length(<span class="mxinfo" id="T7:U37">find(<span class="mxinfo" id="T4:U38"><span class="mxinfo" id="T4:U39"><span class="mxinfo" id="T4:U40"><span class="mxinfo" id="T10:U41"><span class="var type1" id="S13T1U178">I</span>(<span class="mxinfo" id="T15:U43">:</span>,<span class="mxinfo" id="T15:U44">:</span>,<span class="mxinfo" id="T6:U45">1</span>)</span>&gt;=<span class="mxinfo" id="T6:U46">220</span></span>&amp;<span class="mxinfo" id="T4:U47"><span class="mxinfo" id="T10:U48"><span class="var type1" id="S13T1U185">I</span>(<span class="mxinfo" id="T15:U50">:</span>,<span class="mxinfo" id="T15:U51">:</span>,<span class="mxinfo" id="T6:U52">2</span>)</span>&gt;=<span class="mxinfo" id="T6:U53">220</span></span></span>&amp;<span class="mxinfo" id="T4:U54"><span class="mxinfo" id="T10:U55"><span class="var type1" id="S13T1U192">I</span>(<span class="mxinfo" id="T15:U57">:</span>,<span class="mxinfo" id="T15:U58">:</span>,<span class="mxinfo" id="T6:U59">3</span>)</span>&gt;=<span class="mxinfo" id="T6:U60">220</span></span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57"> 57</a></span><span class="line">    <span class="mxinfo" id="T3:U61"><span class="var type1" id="S24T3U199">ratio</span> = <span class="mxinfo" id="T3:U63"><span class="var type1" id="S21T6U201">area_bg</span>/<span class="mxinfo" id="T3:U65">numel(<span class="var type1" id="S19T3U204">grayI</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58"> 58</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U67"><span class="var type1" id="S24T3U208"><span class="message error" id="M1F1C">ratio</span></span></span> &gt;= <span class="var type1" id="S18T6U209">THR</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59"> 59</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60"> 60</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,62"> 62</a></span><span class="line">    <span class="mxinfo" id="T20:U69">tic</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63"> 63</a></span><span class="line">    <span class="mxinfo" id="T21:U70">[<span class="var type0" id="S27T0U217">f</span>,<span class="var type0" id="S28T0U218">L</span>] = segNucleiMorphMeanshift(<span class="var type1" id="S13T1U221">I</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64"> 64</a></span><span class="line">    <span class="var type0" id="S30T0U224">t</span>=toc;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65"> 65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,66"> 66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,67"> 67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68"> 68</a></span><span class="line">    <span class="comment">% BW = L&gt;0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69"> 69</a></span><span class="line">    <span class="comment">% LL = zeros(size(BW));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70"> 70</a></span><span class="line">    <span class="comment">% boundaries = bwboundaries(BW);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71"> 71</a></span><span class="line">    <span class="comment">% num = length(boundaries);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72"> 72</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73"> 73</a></span><span class="line">    <span class="comment">% for i = 1:num</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74"> 74</a></span><span class="line">    <span class="comment">%     b = boundaries{i};</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75"> 75</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76"> 76</a></span><span class="line">    <span class="comment">%     if size(b,1) &gt; 15</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77"> 77</a></span><span class="line">    <span class="comment">%         b(:,2) = lowB(b(:,2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78"> 78</a></span><span class="line">    <span class="comment">%         b(:,1) = lowB(b(:,1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79"> 79</a></span><span class="line">    <span class="comment">%         if any(b(:)&lt;0 | b(:)&gt;4096)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80"> 80</a></span><span class="line">    <span class="comment">%           continue;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81"> 81</a></span><span class="line">    <span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82"> 82</a></span><span class="line">    <span class="comment">%         boundaries{i} = b;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83"> 83</a></span><span class="line">    <span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84"> 84</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85"> 85</a></span><span class="line">    <span class="comment">%     tempBW = roipoly(BW,b(:,2),b(:,1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86"> 86</a></span><span class="line">    <span class="comment">%     if sum(tempBW(:)) == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87"> 87</a></span><span class="line">    <span class="comment">%         continue;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88"> 88</a></span><span class="line">    <span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89"> 89</a></span><span class="line">    <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90"> 90</a></span><span class="line">    <span class="comment">%     LL(tempBW) = count;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91"> 91</a></span><span class="line">    <span class="comment">%     count = count + 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92"> 92</a></span><span class="line">    <span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93"> 93</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,95"> 95</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,96"> 96</a></span><span class="line">    <span class="var type0" id="S32T0U229">BW</span>=bwperim(<span class="var type0" id="S28T0U233">L</span>&gt;0,4);</span></span>
<span class="srcline"><span class="lineno"><a href="1,97"> 97</a></span><span class="line">    <span class="var type0" id="S34T0U238">R</span>=<span class="var type2" id="S13T0U240">I</span>(:,:,1); <span class="var type0" id="S34T0U247">R</span>(<span class="var type0" id="S32T0U248">BW</span>)=0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,98"> 98</a></span><span class="line">    <span class="var type0" id="S35T0U252">G</span>=<span class="var type2" id="S13T0U254">I</span>(:,:,2); <span class="var type0" id="S35T0U261">G</span>(<span class="var type0" id="S32T0U262">BW</span>)=255;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99"> 99</a></span><span class="line">    <span class="var type0" id="S36T0U266">B</span>=<span class="var type2" id="S13T0U268">I</span>(:,:,3); <span class="var type0" id="S36T0U275">B</span>(<span class="var type0" id="S32T0U276">BW</span>)=0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,100">100</a></span><span class="line">    <span class="var type2" id="S13T0U280">I</span>=cat(3,<span class="var type0" id="S34T0U284">R</span>,<span class="var type0" id="S35T0U285">G</span>,<span class="var type0" id="S36T0U286">B</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,101">101</a></span><span class="line">    imwrite(<span class="var type2" id="S13T0U290">I</span>, [<span class="var type2" id="S4T0U293">resultpath</span>, <span class="var type2" id="S3T0U294">filename</span>,<span class="string">'.grid4.jpg'</span>], <span class="string">'Quality'</span>,80);</span></span>
<span class="srcline"><span class="lineno"><a href="1,102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,103">103</a></span><span class="line">    save([<span class="var type2" id="S4T0U303">resultpath</span>, <span class="var type2" id="S3T0U304">filename</span>,<span class="string">'.grid4.mat'</span>],<span class="string">'f'</span>,<span class="string">'L'</span>,<span class="string">'t'</span>,<span class="string">'-v7.3'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,105">105</a></span><span class="line">    <span class="comment">%pais(resultpath,[filename '.grid4.mat'],resultpath,folder,tile,p);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,107">107</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108">108</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,109">109</a></span><span class="line"></span></span>
</pre>
